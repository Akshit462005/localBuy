<!-- Product Form (Used for both Create and Edit) -->
<div class="max-w-2xl mx-auto">
  <div class="bg-white shadow rounded-lg p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">
      <%= product ? 'Edit Product' : 'Add New Product' %>
    </h2>

    <form action="<%= product ? `/api/products/${product.id}` : '/api/products' %>" method="POST" class="space-y-6">
      <% if (product) { %>
        <input type="hidden" name="_method" value="PUT">
      <% } %>

      <div>
        <label for="name" class="block text-sm font-medium text-gray-700">Product Name</label>
        <input type="text" 
               name="name" 
               id="name" 
               value="<%= product ? product.name : '' %>"
               required
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
      </div>

      <div>
        <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
        <textarea name="description" 
                  id="description" 
                  rows="4"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"><%= product ? product.description : '' %></textarea>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="price" class="block text-sm font-medium text-gray-700">Price (â‚¹)</label>
          <input type="number" 
                 name="price" 
                 id="price" 
                 step="0.01"
                 min="0"
                 value="<%= product ? product.price : '' %>"
                 required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
        </div>

        <div>
          <label for="stock" class="block text-sm font-medium text-gray-700">Stock</label>
          <input type="number" 
                 name="stock" 
                 id="stock" 
                 min="0"
                 value="<%= product ? product.stock : 0 %>"
                 required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
        </div>
      </div>

      <div>
        <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
        <select name="category" 
                id="category" 
                required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
          <option value="">Select a category</option>
          <option value="clothing" <%= product && product.category === 'clothing' ? 'selected' : '' %>>Clothing</option>
          <option value="electronics" <%= product && product.category === 'electronics' ? 'selected' : '' %>>Electronics</option>
          <option value="food" <%= product && product.category === 'food' ? 'selected' : '' %>>Food & Beverages</option>
          <option value="home" <%= product && product.category === 'home' ? 'selected' : '' %>>Home & Living</option>
          <option value="beauty" <%= product && product.category === 'beauty' ? 'selected' : '' %>>Beauty & Health</option>
          <option value="books" <%= product && product.category === 'books' ? 'selected' : '' %>>Books & Stationery</option>
          <option value="sports" <%= product && product.category === 'sports' ? 'selected' : '' %>>Sports & Fitness</option>
          <option value="toys" <%= product && product.category === 'toys' ? 'selected' : '' %>>Toys & Games</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
          <select name="gender" 
                  id="gender"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option value="">Not Applicable</option>
            <option value="male" <%= product && product.gender === 'male' ? 'selected' : '' %>>Male</option>
            <option value="female" <%= product && product.gender === 'female' ? 'selected' : '' %>>Female</option>
            <option value="unisex" <%= product && product.gender === 'unisex' ? 'selected' : '' %>>Unisex</option>
          </select>
        </div>

        <div>
          <label for="age_range" class="block text-sm font-medium text-gray-700">Age Range</label>
          <select name="age_range" 
                  id="age_range"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option value="">Not Applicable</option>
            <option value="kids" <%= product && product.age_range === 'kids' ? 'selected' : '' %>>Kids</option>
            <option value="teens" <%= product && product.age_range === 'teens' ? 'selected' : '' %>>Teens</option>
            <option value="adults" <%= product && product.age_range === 'adults' ? 'selected' : '' %>>Adults</option>
            <option value="seniors" <%= product && product.age_range === 'seniors' ? 'selected' : '' %>>Seniors</option>
          </select>
        </div>
      </div>

      <div class="flex justify-end space-x-3">
        <a href="/dashboard/shopkeeper" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
          Cancel
        </a>
        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md">
          <%= product ? 'Update Product' : 'Add Product' %>
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document.querySelector('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData.entries());
    
    try {
      const method = data._method || 'POST';
      const response = await fetch(e.target.action, {
        method: method,
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || 'Failed to save product');
      }

      window.location.href = '/dashboard/shopkeeper';
    } catch (error) {
      console.error('Error saving product:', error);
      alert(error.message || 'Failed to save product');
    }
  });
</script>